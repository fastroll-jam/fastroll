/// PVM Opcodes
#[repr(u8)]
#[derive(Clone, Copy, Debug, Default)]
#[allow(non_camel_case_types)]
pub enum Opcode {
    #[default]
    TRAP = 0,
    FALLTHROUGH = 1,
    ECALLI = 10,
    LOAD_IMM_64 = 20,
    STORE_IMM_U8 = 30,
    STORE_IMM_U16 = 31,
    STORE_IMM_U32 = 32,
    STORE_IMM_U64 = 33,
    JUMP = 40,
    JUMP_IND = 50,
    LOAD_IMM = 51,
    LOAD_U8 = 52,
    LOAD_I8 = 53,
    LOAD_U16 = 54,
    LOAD_I16 = 55,
    LOAD_U32 = 56,
    LOAD_I32 = 57,
    LOAD_U64 = 58,
    STORE_U8 = 59,
    STORE_U16 = 60,
    STORE_U32 = 61,
    STORE_U64 = 62,
    STORE_IMM_IND_U8 = 70,
    STORE_IMM_IND_U16 = 71,
    STORE_IMM_IND_U32 = 72,
    STORE_IMM_IND_U64 = 73,
    LOAD_IMM_JUMP = 80,
    BRANCH_EQ_IMM = 81,
    BRANCH_NE_IMM = 82,
    BRANCH_LT_U_IMM = 83,
    BRANCH_LE_U_IMM = 84,
    BRANCH_GE_U_IMM = 85,
    BRANCH_GT_U_IMM = 86,
    BRANCH_LT_S_IMM = 87,
    BRANCH_LE_S_IMM = 88,
    BRANCH_GE_S_IMM = 89,
    BRANCH_GT_S_IMM = 90,
    MOVE_REG = 100,
    SBRK = 101,
    COUNT_SET_BITS_64 = 102,
    COUNT_SET_BITS_32 = 103,
    LEADING_ZERO_BITS_64 = 104,
    LEADING_ZERO_BITS_32 = 105,
    TRAILING_ZERO_BITS_64 = 106,
    TRAILING_ZERO_BITS_32 = 107,
    SIGN_EXTEND_8 = 108,
    SIGN_EXTEND_16 = 109,
    ZERO_EXTEND_16 = 110,
    REVERSE_BYTES = 111,
    STORE_IND_U8 = 120,
    STORE_IND_U16 = 121,
    STORE_IND_U32 = 122,
    STORE_IND_U64 = 123,
    LOAD_IND_U8 = 124,
    LOAD_IND_I8 = 125,
    LOAD_IND_U16 = 126,
    LOAD_IND_I16 = 127,
    LOAD_IND_U32 = 128,
    LOAD_IND_I32 = 129,
    LOAD_IND_U64 = 130,
    ADD_IMM_32 = 131,
    AND_IMM = 132,
    XOR_IMM = 133,
    OR_IMM = 134,
    MUL_IMM_32 = 135,
    SET_LT_U_IMM = 136,
    SET_LT_S_IMM = 137,
    SHLO_L_IMM_32 = 138,
    SHLO_R_IMM_32 = 139,
    SHAR_R_IMM_32 = 140,
    NEG_ADD_IMM_32 = 141,
    SET_GT_U_IMM = 142,
    SET_GT_S_IMM = 143,
    SHLO_L_IMM_ALT_32 = 144,
    SHLO_R_IMM_ALT_32 = 145,
    SHAR_R_IMM_ALT_32 = 146,
    CMOV_IZ_IMM = 147,
    CMOV_NZ_IMM = 148,
    ADD_IMM_64 = 149,
    MUL_IMM_64 = 150,
    SHLO_L_IMM_64 = 151,
    SHLO_R_IMM_64 = 152,
    SHAR_R_IMM_64 = 153,
    NEG_ADD_IMM_64 = 154,
    SHLO_L_IMM_ALT_64 = 155,
    SHLO_R_IMM_ALT_64 = 156,
    SHAR_R_IMM_ALT_64 = 157,
    ROT_R_64_IMM = 158,
    ROT_R_64_IMM_ALT = 159,
    ROT_R_32_IMM = 160,
    ROT_R_32_IMM_ALT = 161,
    BRANCH_EQ = 170,
    BRANCH_NE = 171,
    BRANCH_LT_U = 172,
    BRANCH_LT_S = 173,
    BRANCH_GE_U = 174,
    BRANCH_GE_S = 175,
    LOAD_IMM_JUMP_IND = 180,
    ADD_32 = 190,
    SUB_32 = 191,
    MUL_32 = 192,
    DIV_U_32 = 193,
    DIV_S_32 = 194,
    REM_U_32 = 195,
    REM_S_32 = 196,
    SHLO_L_32 = 197,
    SHLO_R_32 = 198,
    SHAR_R_32 = 199,
    ADD_64 = 200,
    SUB_64 = 201,
    MUL_64 = 202,
    DIV_U_64 = 203,
    DIV_S_64 = 204,
    REM_U_64 = 205,
    REM_S_64 = 206,
    SHLO_L_64 = 207,
    SHLO_R_64 = 208,
    SHAR_R_64 = 209,
    AND = 210,
    XOR = 211,
    OR = 212,
    MUL_UPPER_S_S = 213,
    MUL_UPPER_U_U = 214,
    MUL_UPPER_S_U = 215,
    SET_LT_U = 216,
    SET_LT_S = 217,
    CMOV_IZ = 218,
    CMOV_NZ = 219,
    ROT_L_64 = 220,
    ROT_L_32 = 221,
    ROT_R_64 = 222,
    ROT_R_32 = 223,
    AND_INV = 224,
    OR_INV = 225,
    XNOR = 226,
    MAX = 227,
    MAX_U = 228,
    MIN = 229,
    MIN_U = 230,
}

impl From<u8> for Opcode {
    fn from(value: u8) -> Self {
        match value {
            0 => Opcode::TRAP,
            1 => Opcode::FALLTHROUGH,
            10 => Opcode::ECALLI,
            20 => Opcode::LOAD_IMM_64,
            30 => Opcode::STORE_IMM_U8,
            31 => Opcode::STORE_IMM_U16,
            32 => Opcode::STORE_IMM_U32,
            33 => Opcode::STORE_IMM_U64,
            40 => Opcode::JUMP,
            50 => Opcode::JUMP_IND,
            51 => Opcode::LOAD_IMM,
            52 => Opcode::LOAD_U8,
            53 => Opcode::LOAD_I8,
            54 => Opcode::LOAD_U16,
            55 => Opcode::LOAD_I16,
            56 => Opcode::LOAD_U32,
            57 => Opcode::LOAD_I32,
            58 => Opcode::LOAD_U64,
            59 => Opcode::STORE_U8,
            60 => Opcode::STORE_U16,
            61 => Opcode::STORE_U32,
            62 => Opcode::STORE_U64,
            70 => Opcode::STORE_IMM_IND_U8,
            71 => Opcode::STORE_IMM_IND_U16,
            72 => Opcode::STORE_IMM_IND_U32,
            73 => Opcode::STORE_IMM_IND_U64,
            80 => Opcode::LOAD_IMM_JUMP,
            81 => Opcode::BRANCH_EQ_IMM,
            82 => Opcode::BRANCH_NE_IMM,
            83 => Opcode::BRANCH_LT_U_IMM,
            84 => Opcode::BRANCH_LE_U_IMM,
            85 => Opcode::BRANCH_GE_U_IMM,
            86 => Opcode::BRANCH_GT_U_IMM,
            87 => Opcode::BRANCH_LT_S_IMM,
            88 => Opcode::BRANCH_LE_S_IMM,
            89 => Opcode::BRANCH_GE_S_IMM,
            90 => Opcode::BRANCH_GT_S_IMM,
            100 => Opcode::MOVE_REG,
            101 => Opcode::SBRK,
            102 => Opcode::COUNT_SET_BITS_64,
            103 => Opcode::COUNT_SET_BITS_32,
            104 => Opcode::LEADING_ZERO_BITS_64,
            105 => Opcode::LEADING_ZERO_BITS_32,
            106 => Opcode::TRAILING_ZERO_BITS_64,
            107 => Opcode::TRAILING_ZERO_BITS_32,
            108 => Opcode::SIGN_EXTEND_8,
            109 => Opcode::SIGN_EXTEND_16,
            110 => Opcode::ZERO_EXTEND_16,
            111 => Opcode::REVERSE_BYTES,
            120 => Opcode::STORE_IND_U8,
            121 => Opcode::STORE_IND_U16,
            122 => Opcode::STORE_IND_U32,
            123 => Opcode::STORE_IND_U64,
            124 => Opcode::LOAD_IND_U8,
            125 => Opcode::LOAD_IND_I8,
            126 => Opcode::LOAD_IND_U16,
            127 => Opcode::LOAD_IND_I16,
            128 => Opcode::LOAD_IND_U32,
            129 => Opcode::LOAD_IND_I32,
            130 => Opcode::LOAD_IND_U64,
            131 => Opcode::ADD_IMM_32,
            132 => Opcode::AND_IMM,
            133 => Opcode::XOR_IMM,
            134 => Opcode::OR_IMM,
            135 => Opcode::MUL_IMM_32,
            136 => Opcode::SET_LT_U_IMM,
            137 => Opcode::SET_LT_S_IMM,
            138 => Opcode::SHLO_L_IMM_32,
            139 => Opcode::SHLO_R_IMM_32,
            140 => Opcode::SHAR_R_IMM_32,
            141 => Opcode::NEG_ADD_IMM_32,
            142 => Opcode::SET_GT_U_IMM,
            143 => Opcode::SET_GT_S_IMM,
            144 => Opcode::SHLO_L_IMM_ALT_32,
            145 => Opcode::SHLO_R_IMM_ALT_32,
            146 => Opcode::SHAR_R_IMM_ALT_32,
            147 => Opcode::CMOV_IZ_IMM,
            148 => Opcode::CMOV_NZ_IMM,
            149 => Opcode::ADD_IMM_64,
            150 => Opcode::MUL_IMM_64,
            151 => Opcode::SHLO_L_IMM_64,
            152 => Opcode::SHLO_R_IMM_64,
            153 => Opcode::SHAR_R_IMM_64,
            154 => Opcode::NEG_ADD_IMM_64,
            155 => Opcode::SHLO_L_IMM_ALT_64,
            156 => Opcode::SHLO_R_IMM_ALT_64,
            157 => Opcode::SHAR_R_IMM_ALT_64,
            158 => Opcode::ROT_R_64_IMM,
            159 => Opcode::ROT_R_64_IMM_ALT,
            160 => Opcode::ROT_R_32_IMM,
            161 => Opcode::ROT_R_32_IMM_ALT,
            170 => Opcode::BRANCH_EQ,
            171 => Opcode::BRANCH_NE,
            172 => Opcode::BRANCH_LT_U,
            173 => Opcode::BRANCH_LT_S,
            174 => Opcode::BRANCH_GE_U,
            175 => Opcode::BRANCH_GE_S,
            180 => Opcode::LOAD_IMM_JUMP_IND,
            190 => Opcode::ADD_32,
            191 => Opcode::SUB_32,
            192 => Opcode::MUL_32,
            193 => Opcode::DIV_U_32,
            194 => Opcode::DIV_S_32,
            195 => Opcode::REM_U_32,
            196 => Opcode::REM_S_32,
            197 => Opcode::SHLO_L_32,
            198 => Opcode::SHLO_R_32,
            199 => Opcode::SHAR_R_32,
            200 => Opcode::ADD_64,
            201 => Opcode::SUB_64,
            202 => Opcode::MUL_64,
            203 => Opcode::DIV_U_64,
            204 => Opcode::DIV_S_64,
            205 => Opcode::REM_U_64,
            206 => Opcode::REM_S_64,
            207 => Opcode::SHLO_L_64,
            208 => Opcode::SHLO_R_64,
            209 => Opcode::SHAR_R_64,
            210 => Opcode::AND,
            211 => Opcode::XOR,
            212 => Opcode::OR,
            213 => Opcode::MUL_UPPER_S_S,
            214 => Opcode::MUL_UPPER_U_U,
            215 => Opcode::MUL_UPPER_S_U,
            216 => Opcode::SET_LT_U,
            217 => Opcode::SET_LT_S,
            218 => Opcode::CMOV_IZ,
            219 => Opcode::CMOV_NZ,
            220 => Opcode::ROT_L_64,
            221 => Opcode::ROT_L_32,
            222 => Opcode::ROT_R_64,
            223 => Opcode::ROT_R_32,
            224 => Opcode::AND_INV,
            225 => Opcode::OR_INV,
            226 => Opcode::XNOR,
            227 => Opcode::MAX,
            228 => Opcode::MAX_U,
            229 => Opcode::MIN,
            230 => Opcode::MIN_U,
            _ => Opcode::TRAP, // Unknown opcode is interpreted as TRAP
        }
    }
}

impl Opcode {
    #[inline(always)]
    pub fn from_u8(value: u8) -> Self {
        Self::from(value)
    }

    #[inline(always)]
    pub fn is_termination_opcode(&self) -> bool {
        use Opcode::*;
        matches!(
            self,
            TRAP | FALLTHROUGH
                | JUMP
                | JUMP_IND
                | LOAD_IMM_JUMP
                | LOAD_IMM_JUMP_IND
                | BRANCH_EQ_IMM
                | BRANCH_NE_IMM
                | BRANCH_LT_U_IMM
                | BRANCH_LE_U_IMM
                | BRANCH_GE_U_IMM
                | BRANCH_GT_U_IMM
                | BRANCH_LT_S_IMM
                | BRANCH_LE_S_IMM
                | BRANCH_GE_S_IMM
                | BRANCH_GT_S_IMM
                | BRANCH_EQ
                | BRANCH_NE
                | BRANCH_LT_U
                | BRANCH_LT_S
                | BRANCH_GE_U
                | BRANCH_GE_S
        )
    }
}
